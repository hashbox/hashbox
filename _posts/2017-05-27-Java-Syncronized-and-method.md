---
layout: post
current: post
cover: False
navigation: True
title: Java syncronized, wait, notify, notifyAll에 대하여
date: 2017-05-27 13:54:00
tags: develop
class: post-template
subclass: 'post tag-develop'
logo: assets/images/slaysd.png
author: slaysd
---

<p></p>

# 개요
자바를 사용하면서 쓰레드를 사용한 개발이 필요할 때가 있습니다. 그럴때마다 따라오게 되는 것이 `syncronized`와 `wait`, `notify`, `notifyAll`이 있습니다. 어쩔 때 사용한다는 것은 알지만 정확한 작동 원리를 알지 못하고 무분별하게 쓰는 것 같아 자세한 내용을 공부하고 글을 남기게 되었습니다.
* * *
## Syncronized
`syncronized`는 쓰레드를 사용할 때 동기화가 필요한 부분 즉, 임계영역을 설정할 때 사용합니다. 자바에서 `syncronized`를 사용하는 방법은 두가지가 있는데요.
* * *
## 함수에 명시하는 방법
```java
public syncronized void get() {
    ...
}

public syncronized void set() {
    ...
}
```
<br/><br/>
## 객체에 명시하는 방법
```java
public void get() {
    syncronized(this) {
        ...
    }
}
```

이렇게 두가지 방법을 지원합니다. 

첫번째 방법인 함수에 명시하는 방법은 해당하는 인스턴스 메소드를 사용할 때만 동기화를 걸어준다고 생각하시면 됩니다. 예를들어 A와 B 쓰레드가 있을 때 A가 `get()`을 사용할 때 락을 가지게 되고 임계영역인 `get()` 메소드에 진입했을 때 B가 `set()`을 사용하려고 해도 락을 가지고 있지 않아 대기하게 됩니다. 어떻게 보면 함수 객체 내에 특정 메소드에만 임계영역을 지정해줌으로써 동기화가 필요하지 않은 메소드에 대해서는 사용이 가능합니다.

두번째 방법인 객체에 명시하는 방법은 해당 객체에 락을 걸어 버리는 것으로 해당 A가 해당 객체를 사용할 때 B는 해당 객체에 진입을 못하는 것에서 차이가 보입니다.

저의 개인적인 생각으로는 첫번째 방법을 사용하는 것이 교착상태에 빠지지 않아 안전하고, 더 빠른 소프트웨어가 아닐까 생각됩니다.
* * *
## Wait & Notify, NotifyAll
`syncronized`와 함께 따라 오게되는 메소드들이 `wait()`, `notify()`, `notifyAll()`이 있을 텐데요. 3개의 메소드는 `syncronized`로 지정된 임계영역에서만 사용이 가능한 함수입니다.

`wait()`는 락을 가지고 들어온 스레드를 `wait()`가 호출된 곳에서 락을 해제하고 잠들게 만듭니다. 일종의 대기실로 들어가게 되는 것인데요. 이럴 경우 A가 락을 가지고 먼저 인스턴스의 `syncronized` 영역에 들어갔을 때 B는 인스턴스의 `syncronized`에 접근하고자 할 때 락을 얻지 못해 대기하게 됩니다. 이때 A가 `wait()`을 만나면 호출된 위치에서 락을 해제하고 잠들게 되고 B는 락을 가짐으로써 `syncronized`영역에 들어갈 수 있게 됩니다.

`notify()`와 `notifyAll()`는 잠들어 있는 쓰레드를 깨울 때 사용하게 되는데요. 사실 저도 이 두개의 차이를 조금은 헷갈리기도 했습니다. 그렇기 때문에 서적을 찾아 차이점을 알게되어 글로 남기게 됩니다.

`notify()`는 `wait()`로 잠든 스레드들 중 자바 머신에서 어떤 정책에 의해서 깨우게 되게 됩니다. ~~어떤 정책에 대해서는 한번 알아보고 추가하도록 하겠습니다~~ 그렇기 때문에 개발자는 어떤 쓰레드가 선택될지는 알수가 없습니다.

`notifyAll()`은 `wait()`로 잠든 모든 스레드를 동시에 깨워 냅니다. 하지만 이것은 모든 스레드가 임계영역에 들여올 수 있는 것은 아닙니다. 동시에 일어날 뿐 그 중 한 스레드가 락을 가지게 된다면 다른 스레드는 잠들게 됩니다.
